{{define "head"}}
<title>Trading Account</title>
{{end}}

{{define "content"}}

<main class="p-4 mb-auto md:max-w-[1200px] overflow-auto w-full mx-auto">
    <script>
        document.addEventListener('htmx:afterSwap', function (evt) {
            if (evt.detail.requestConfig.elt.id === 'add-trading-account-form') {
                if (evt.detail.target.id === 'table-body') {
                    add_modal.close();
                }
            }
        });

        document.addEventListener('htmx:afterRequest', function (evt) {
            if (evt.detail.xhr.status === 500) {
                // Display an alert or perform any other error handling
            }
        });
    </script>

    <h1 class="mb-4 text-4xl font-extrabold leading-none tracking-tight text-gray-900 md:text-5xl lg:text-6xl dark:text-white">
        Trading Accounts
    </h1>
    <div class="card w-full bg-base-100 shadow-xl">
        <div class="flex  overflow-x-auto">
            <div class="flex-grow"></div>
            <!-- Open the modal using ID.showModal() method -->
            <button class="btn btn-link" onclick="add_modal.showModal()">Add</button>
            <dialog id="add_modal" class="modal">
                <div class="modal-box">
                    <h3 class="font-bold text-lg">Add Trading Account</h3>
                    <form class="mt-4"
                          id="add-trading-account-form"
                          hx-post="/tradingaccount"
                          hx-swap="afterbegin"
                          hx-target="#table-body"
                    >
                        <div class="label">
                            <span class="label-text">Exchange</span>
                        </div>
                        <select class="select select-bordered w-full"
                                name="exchange"
                        >
                            <option value="upbit" selected>Upbit</option>
                            <option value="binance">Binance</option>
                        </select>

                        <div class="mt-4 label">
                            <span class="label-text">Currency</span>
                        </div>
                        <select class="select select-bordered w-full"
                                name="currency"
                        >
                            <option value="KRW" selected>KRW</option>
                            <option value="USD">USD</option>
                        </select>

                        <div class="mt-4 label">
                            <span class="label-text">Identifier</span>
                        </div>
                        <input type="text" name="identifier" placeholder="Type here"
                               class="input input-bordered w-full"/>

                        <div class="mt-4 label">
                            <span class="label-text">Credential</span>
                        </div>
                        <input type="password" name="credential" placeholder="Type here"
                               class="input input-bordered w-full"/>

                        <button type="submit" class="btn btn-primary mt-4"
                                hx-post="/tradingaccount/add"
                                hx-trigger="submit"
                                hx-swap="innerHTML"
                                hx-target="#add_model .modal-action"
                        >
                            Add
                        </button>
                    </form>

                    <div class="modal-action">
                        <form method="dialog">
                            <!-- if there is a button in form, it will close the modal -->
                            <button class="btn">Close</button>
                        </form>
                    </div>
                </div>
            </dialog>
        </div>
        <div class="overflow-x-auto">
            <table class="table">
                <!-- head -->
                <thead>
                <tr>
                    <th>Exchange</th>
                    <th>Currency</th>
                    <th>Identifier</th>
                    <th>IP</th>
                    <th>Action</th>
                </tr>
                </thead>
                <!-- body -->
                <tbody id="table-body"
                       hx-get="/tradingaccount/list"
                       hx-trigger="load"
                       hx-swap="innerHTML"
                >
                </tbody>
            </table>
        </div>
    </div>
</main>
{{end}}
